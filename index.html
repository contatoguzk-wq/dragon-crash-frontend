<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dragon Crash</title>

<style>
body {
  background:#0b0b0b;
  color:#fff;
  font-family:Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.card {
  background:#111;
  padding:25px;
  border-radius:15px;
  width:360px;
  box-shadow:0 0 30px rgba(0,255,180,.4);
  text-align:center;
}

h1 { color:#00ffb3 }

.mult {
  font-size:48px;
  color:#00ffb3;
}

input,button {
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:8px;
}

button { cursor:pointer; font-weight:bold }

.apostar { background:#00ffb3; }
.cashout { background:#ff4d4d; color:#fff }
.disabled { opacity:.4; pointer-events:none }

.status { margin-top:8px; font-size:14px }

ul { list-style:none; padding:0; margin-top:10px; text-align:left }
li { font-size:14px; margin-bottom:4px }
</style>
</head>

<body>

<div class="card">
  <h1>üêâ Dragon Crash</h1>

  <div class="mult" id="mult">1.00x</div>
  <div id="contador"></div>

  <input type="number" id="aposta" placeholder="Valor da aposta">

  <button class="apostar" id="btnApostar">APOSTAR</button>
  <button class="cashout disabled" id="btnCashout">CASHOUT</button>

  <div class="status" id="status"></div>

  <h3>üìä √öltimas rodadas</h3>
  <ul id="historico"></ul>
</div>

<script>
/* =========================
   CONFIG
========================= */
const API = "https://dragon-crash-backend.onrender.com";
const playerId = "player123"; // depois vira login real

/* =========================
   ELEMENTOS
========================= */
const multEl = document.getElementById("mult");
const contadorEl = document.getElementById("contador");
const statusEl = document.getElementById("status");
const historicoEl = document.getElementById("historico");

const apostaEl = document.getElementById("aposta");
const btnApostar = document.getElementById("btnApostar");
const btnCashout = document.getElementById("btnCashout");

/* =========================
   ESTADO LOCAL
========================= */
let apostaAtiva = false;
let multAtual = 1;
let multAlvo = 1;
let animando = false;

/* =========================
   GAME LOOP
========================= */
async function atualizarGame() {
  const res = await fetch(API + "/game");
  const data = await res.json();

  multAlvo = data.multiplicador;
  if (!animando) animarMultiplicador();

  if (data.estado === "AGUARDANDO") {
    contadorEl.innerText = `‚è≥ Nova rodada em ${data.segundosRestantes}s`;
    statusEl.innerText = "Aguardando apostas";
    btnApostar.classList.remove("disabled");
    btnCashout.classList.add("disabled");
    apostaAtiva = false;
    multAtual = 1;
    multEl.innerText = "1.00x";
  }

  if (data.estado === "CORRENDO") {
    contadorEl.innerText = "";
    statusEl.innerText = "Rodada em andamento";
    btnApostar.classList.add("disabled");
    if (apostaAtiva) btnCashout.classList.remove("disabled");
  }

  if (data.estado === "ACIDENTOU") {
    contadorEl.innerText = "üí• CRASHOU";
    statusEl.innerText = "Rodada finalizada";
    btnCashout.classList.add("disabled");
    apostaAtiva = false;
  }
}

/* =========================
   ANIMA√á√ÉO
========================= */
function animarMultiplicador() {
  animando = true;

  function frame() {
    if (multAtual < multAlvo) {
      multAtual += 0.02;
      if (multAtual > multAlvo) multAtual = multAlvo;
      multEl.innerText = multAtual.toFixed(2) + "x";
      requestAnimationFrame(frame);
    } else {
      animando = false;
    }
  }

  requestAnimationFrame(frame);
}

/* =========================
   APOSTAR
========================= */
btnApostar.onclick = async () => {
  const valor = Number(apostaEl.value);
  if (!valor || valor <= 0) {
    alert("Valor inv√°lido");
    return;
  }

  const res = await fetch(API + "/bet", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ playerId, valor })
  });

  const data = await res.json();
  if (data.erro) {
    alert(data.erro);
    return;
  }

  apostaAtiva = true;
  statusEl.innerText = "‚úÖ Aposta confirmada!";
};

/* =========================
   CASHOUT
========================= */
btnCashout.onclick = async () => {
  if (!apostaAtiva) return;

  const res = await fetch(API + "/cashout", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ playerId })
  });

  const data = await res.json();
  if (data.erro) {
    alert(data.erro);
    return;
  }

  statusEl.innerText = `üí∞ Cashout: R$ ${data.ganho.toFixed(2)}`;
  apostaAtiva = false;
  btnCashout.classList.add("disabled");
};

/* =========================
   HIST√ìRICO
========================= */
async function atualizarHistorico() {
  const res = await fetch(API + "/history");
  const data = await res.json();

  historicoEl.innerHTML = "";
  data.forEach(r => {
    const li = document.createElement("li");
    li.innerText = `üí• ${r.crash}x (${r.hora})`;
    historicoEl.appendChild(li);
  });
}

/* =========================
   LOOPS
========================= */
setInterval(atualizarGame, 300);
setInterval(atualizarHistorico, 1000);
</script>

</body>
</html>
